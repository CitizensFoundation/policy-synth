# PolicySynth Events

This module provides a centralized event emitter for PolicySynth agent and model events, with a focus on tracking AI model token usage. It defines the event types and constants used for emitting and listening to token usage events throughout the PolicySynth system.

**File:** `@policysynth/agents/base/events.js`

---

## Exports

### `policySynthEvents`

An instance of Node.js [`EventEmitter`](https://nodejs.org/api/events.html#class-eventemitter) used for broadcasting and subscribing to PolicySynth-related events.

**Type:** `EventEmitter`

---

### `TokenUsageEvent`

A TypeScript type describing the payload for token usage events. This event is emitted whenever an AI model processes tokens, allowing for tracking and analytics.

| Name                  | Type                | Description                                                                                 |
|-----------------------|---------------------|---------------------------------------------------------------------------------------------|
| modelName             | `string`            | The name of the AI model used.                                                              |
| modelProvider         | `string`            | The provider of the AI model (e.g., "openai", "azure").                                     |
| modelType             | `PsAiModelType`     | The type of the AI model (see `PsAiModelType` enum).                                        |
| modelSize             | `PsAiModelSize`     | The size of the AI model (see `PsAiModelSize` enum).                                        |
| tokensIn              | `number`            | Number of input tokens processed by the model.                                              |
| tokensOut             | `number`            | Number of output tokens generated by the model.                                             |
| cachedInTokens        | `number?`           | (Optional) Number of input tokens retrieved from cache/context.                             |
| longContextTokenIn    | `number?`           | (Optional) Number of input tokens in long context.                                          |
| longContextTokenInCached | `number?`        | (Optional) Number of cached input tokens in long context.                                   |
| longContextTokenOut   | `number?`           | (Optional) Number of output tokens in long context.                                         |
| agentId               | `number?`           | (Optional) The ID of the agent associated with this event.                                  |
| userId                | `number?`           | (Optional) The ID of the user who triggered the event.                                      |
| modelId               | `number?`           | (Optional) The ID of the model instance.                                                    |
| timestamp             | `number`            | Unix timestamp (milliseconds) when the event occurred.                                      |

---

### `TOKEN_USAGE_EVENT`

A string constant representing the event name for token usage events.

**Type:** `"tokenUsage"`

---

## Example

```typescript
import { policySynthEvents, TOKEN_USAGE_EVENT, TokenUsageEvent } from "@policysynth/agents/base/events.js";

// Listen for token usage events
policySynthEvents.on(TOKEN_USAGE_EVENT, (event: TokenUsageEvent) => {
  console.log(`Model ${event.modelName} used ${event.tokensIn} input tokens and ${event.tokensOut} output tokens.`);
});

// Emit a token usage event
const usage: TokenUsageEvent = {
  modelName: "gpt-4",
  modelProvider: "openai",
  modelType: "chat",
  modelSize: "large",
  tokensIn: 1024,
  tokensOut: 256,
  timestamp: Date.now(),
  userId: 42,
  agentId: 7,
};

policySynthEvents.emit(TOKEN_USAGE_EVENT, usage);
```

---

**Usage Notes:**
- Use `policySynthEvents` to subscribe to or emit events related to AI model usage.
- The `TokenUsageEvent` type ensures consistent event payloads for analytics and monitoring.
- The `TOKEN_USAGE_EVENT` constant should be used as the event name to avoid typos and ensure consistency.