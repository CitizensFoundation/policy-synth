{"version":3,"file":"ps-ai-chat-element.js","sourceRoot":"","sources":["../../src/chatBot/ps-ai-chat-element.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\n\nimport { resolveMarkdown } from './litMarkdown.js';\nimport '@material/web/icon/icon.js';\nimport '@material/web/checkbox/checkbox.js';\n\nimport '@material/web/button/outlined-button.js';\nimport '@material/web/button/filled-button.js';\nimport '@material/web/button/elevated-button.js';\nimport '@material/web/textfield/filled-text-field.js';\n\nimport '@material/web/progress/circular-progress.js';\nimport { jsonrepair } from 'jsonrepair';\nimport '@yrpri/webapp/common/yp-image.js';\nimport { MdCheckbox } from '@material/web/checkbox/checkbox.js';\nimport { BaseChatBotServerApi } from './BaseChatBotApi.js';\nimport { YpBaseElement } from '@yrpri/webapp/common/yp-base-element.js';\n\n@customElement('ps-ai-chat-element')\nexport class PsAiChatElement extends YpBaseElement {\n  @property({ type: String })\n  message!: string;\n\n  @property({ type: Object })\n  wsMessage!: PsAiChatWsMessage;\n\n  @property({ type: String })\n  updateMessage: string;\n\n  @property({ type: String })\n  sender!: 'you' | 'bot';\n\n  @property({ type: String })\n  detectedLanguage!: string;\n\n  @property({ type: Number })\n  clusterId!: number;\n\n  @property({ type: String })\n  type:\n    | 'start'\n    | 'error'\n    | 'moderation_error'\n    | 'info'\n    | 'welcomeMessage'\n    | 'message'\n    | 'thinking'\n    | 'noStreaming'\n    | undefined;\n\n  @property({ type: Boolean })\n  spinnerActive = false;\n\n  @property({ type: Boolean })\n  fullReferencesOpen = false;\n\n  @property({ type: String })\n  followUpQuestionsRaw: string = '';\n\n  @property({ type: Array })\n  followUpQuestions: string[] = [];\n\n  @property({ type: Boolean })\n  jsonLoading = false;\n\n  api: BaseChatBotServerApi;\n\n  constructor() {\n    super();\n    this.api = new BaseChatBotServerApi();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    // Subscribe to MarkdownDirective events\n    this.addEventListener('jsonLoadingStart', this.handleJsonLoadingStart);\n    this.addEventListener('jsonLoadingEnd', this.handleJsonLoadingEnd);\n  }\n\n  override disconnectedCallback() {\n    // Remove event listeners for MarkdownDirective\n    this.removeEventListener('jsonLoadingStart', this.handleJsonLoadingStart);\n    this.removeEventListener('jsonLoadingEnd', this.handleJsonLoadingEnd);\n\n    super.disconnectedCallback();\n  }\n\n  stopJsonLoading() {\n    this.jsonLoading = false;\n  }\n\n  handleJsonLoadingStart = () => {\n    console.log('JSON loading start event triggered');\n    this.jsonLoading = true;\n    this.requestUpdate(); // If needed to trigger a re-render\n  };\n\n  handleJsonLoadingEnd = (event: any) => {\n    const jsonContent = event.detail;\n    console.log(\n      'JSON loading end event triggered with JSON content:',\n      jsonContent\n    );\n    this.jsonLoading = false;\n    let jsonContentParsed: CrtRefinedCausesReply | undefined = undefined;\n    try {\n      jsonContentParsed = JSON.parse(\n        jsonContent.jsonContent\n      ) as CrtRefinedCausesReply;\n    } catch (e) {\n      console.error('Error parsing JSON content:', e);\n      try {\n        jsonContentParsed = JSON.parse(jsonrepair(jsonContent.jsonContent));\n      } catch (e) {\n        console.error('Error parsing JSON content again:', e);\n      }\n    }\n  };\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: flex;\n        }\n        .chatImage {\n          padding: 8px;\n          vertical-align: text-top;\n        }\n\n        .robotIcon {\n          --md-icon-size: 34px;\n        }\n\n        .chatText {\n          padding: 8px;\n          padding-left: 8px;\n          margin-top: 0;\n          padding-top: 2px;\n        }\n\n        .chatTextUser {\n        }\n\n        .userChatDialog {\n          color: var(--md-sys-color-on-surface);\n          background-color: var(--md-sys-color-surface-container);\n          padding: 8px;\n          margin: 16px;\n          line-height: 1.5;\n          margin-bottom: 0px;\n          border-radius: 12px;\n        }\n\n        .post {\n          margin: 8px;\n          padding: 12px;\n          border-radius: 24px;\n          margin-right: 0;\n          background-color: var(--md-sys-color-secondary);\n          color: var(--md-sys-color-on-secondary);\n          cursor: pointer;\n        }\n\n        .refinedCausesSuggestionshowMore {\n          padding-left: 16px;\n          padding-right: 16px;\n        }\n\n        .postImage {\n          height: 28px;\n          width: 50px;\n        }\n\n        .postName {\n          display: flex;\n          justify-content: center;\n          align-content: center;\n          flex-direction: column;\n          margin-right: 8px;\n        }\n\n        .chatGPTDialogContainer {\n          max-width: 100%;\n          width: 100%;\n        }\n\n        .chatGPTDialog {\n          color: var(--md-sys-color-on-surface);\n          background-color: var(--md-sys-color-surface);\n          padding: 8px;\n          margin: 16px;\n          line-height: 1.5;\n          margin-bottom: 0px;\n          border-radius: 10px;\n          max-width: 89%;\n          margin-top: 12px;\n        }\n\n        @media (max-width: 800px) {\n          .chatGPTDialog {\n            margin: 8px;\n            max-width: 100%;\n          }\n        }\n\n        .chatGPTDialog[error] {\n          background-color: var(--md-sys-color-error);\n          color: var(--md-sys-color-on-error);\n        }\n\n        .followup-question-container {\n          margin-top: 12px;\n          width: 100%;\n          align-self: flex-end;\n          justify-content: flex-end;\n          margin-right: 32px;\n          width: 100%;\n        }\n\n        .labelText {\n          padding-left: 6px;\n          width: 100%;\n        }\n\n        md-circular-progress {\n          --md-circular-progress-size: 32px;\n          width: 32px;\n          height: 32px;\n          margin-top: 8px;\n        }\n\n        .refinedSuggestions {\n          padding: 0;\n          border-radius: 8px;\n          margin: 16px;\n          margin-top: 0;\n        }\n\n        .refinedSuggestions label {\n          display: flex;\n          align-items: center;\n          margin-bottom: 0; // Reduced margin for a tighter layout\n          padding: 8px;\n        }\n\n        .labelText {\n          margin-left: 4px; // Adjust as needed\n        }\n\n        .refinedContainer {\n          padding: 0;\n        }\n\n        .directCause {\n          background-color: var(--md-sys-color-primary);\n          color: var(--md-sys-color-on-primary);\n          margin-bottom: 16px !important;\n          border-radius: 16px;\n        }\n\n        .assumption {\n          background-color: var(--md-sys-color-secondary);\n          color: var(--md-sys-color-on-secondary);\n          margin-bottom: 16px !important;\n          border-radius: 16px;\n        }\n\n        .assumptionCheckbox {\n          --md-checkbox-outline-color: var(--md-sys-color-on-secondary);\n          --md-checkbox-hover-outline-color: var(--md-sys-color-on-primary);\n        }\n\n        .directCauseCheckbox {\n          --md-checkbox-outline-color: var(--md-sys-color-on-primary);\n          --md-checkbox-hover-outline-color: var(--md-sys-color-on-secondary);\n        }\n\n        md-filled-button {\n          max-width: 250px;\n          margin-top: 16px;\n          margin-bottom: 16px;\n        }\n\n        .refinedCausesSuggestions {\n          margin-top: 8px;\n          margin-left: 36px;\n          margin-right: 36px;\n          margin-bottom: 22px;\n          padding: 8px;\n          border-radius: 12px;\n          background-color: var(--md-sys-color-tertiary-container);\n          color: var(--md-sys-color-on-tertiary-container);\n        }\n        .followup-question {\n          padding: 0;\n          margin: 6px;\n        }\n\n        .chat-message {\n          flex: 1;\n        }\n\n        .thinkingText {\n          margin-top: 4px;\n          margin-left: 6px;\n          color: var(--md-sys-color-secondary);\n        }\n\n        .thinkingText[spinnerActive] {\n          color: var(--md-sys-color-primary);\n        }\n\n        .doneIcon {\n          margin-left: 16px;\n          margin-right: 4px;\n          color: var(--md-sys-color-secondary);\n          font-size: 28px;\n        }\n\n        .postCitation {\n          font-size: 9px;\n          background-color: var(--md-sys-color-inverse-on-surface);\n          color: var(--md-sys-color-primary);\n          padding: 3px;\n        }\n\n        md-checkbox {\n          margin: 15px;\n        }\n\n        .followUpQuestionMark {\n          color: var(--md-sys-color-primary);\n          font-size: 36px;\n          margin-top: 8px;\n        }\n\n        .citationLink {\n          margin-left: 8px;\n          margin-bottom: 8px;\n        }\n\n        .progress-ring {\n          transform: rotate(-90deg);\n          color: var(--md-sys-color-secondary);\n          transform-origin: 50% 50%;\n          margin-left: 16px;\n          margin-right: 4px;\n        }\n        .progress-ring__circle {\n          stroke: var(--md-sys-color-primary);\n          stroke-dasharray: 75.4;\n          stroke-dashoffset: 75.4;\n          stroke-linecap: round;\n          animation: progress-ring 2.5s infinite;\n        }\n        @keyframes progress-ring {\n          0% {\n            stroke-dashoffset: 75.4;\n          }\n          50% {\n            stroke-dashoffset: 0;\n            transform: rotate(0deg);\n          }\n        }\n\n        .suggestionsHeader {\n          font-size: 18px;\n          color: var(--md-sys-color-primary);\n          margin-bottom: 16px;\n        }\n\n        .sourceFavIcon {\n          margin-right: 8px;\n        }\n\n        .sourceButton {\n          margin: 8px;\n          padding: 8px;\n          max-width: 250px;\n          max-height: 60px;\n          height: 60px;\n          line-height: 1.2;\n          white-space: collapse balance;\n          font-size: 12px;\n          --md-elevated-button-container-height: 60px !important;\n          --md-elevated-button-hover-label-text-color: var(\n            --md-sys-color-on-surface\n          );\n        }\n\n        .sourceContainer {\n          text-align: left;\n        }\n\n        a {\n          color: var(--md-sys-color-primary);\n         }\n      `,\n    ];\n  }\n\n  get isError() {\n    return this.type == 'error' || this.type == 'moderation_error';\n  }\n\n  renderCGImage() {\n    return html` <md-icon class=\"robotIcon\">smart_toy</md-icon> `;\n  }\n\n  renderRoboImage() {\n    return html` <md-icon class=\"robotIcon\">person</md-icon> `;\n  }\n\n  renderJson() {\n    return html``;\n  }\n\n  renderInfo() {\n    if (this.wsMessage && this.wsMessage.data && this.wsMessage.data) {\n      const data = this.wsMessage.data as PsRagDocumentSourcesWsData;\n      if (data.name === 'sourceDocuments') {\n        console.error(JSON.stringify(data));\n        return html`<div\n          class=\"layout horizontal  wrap sourceDocumentsContainer\"\n        >\n          ${data.message.map(\n            document => html`\n              <md-elevated-button\n                class=\"sourceButton\"\n                @click=${() => this.fire('ps-open-source-dialog', document)}\n              >\n                <div class=\"layout horizontal sourceContainer\">\n                  <img\n                    src=\"https://www.google.com/s2/favicons?domain=${this.stripDomainForFacIcon(\n                      document.url\n                    )}&sz=24\"\n                    slot=\"icon\"\n                    width=\"24\"\n                    height=\"24\"\n                    class=\"sourceFavIcon\"\n                  />\n                  <div class=\"documentShortDescription\">\n                    ${this.shortenText(\n                      `${this.capitalizeFirstLetter(document.title)}: ${\n                        document.description\n                      }`,\n                      65\n                    )}\n                  </div>\n                </div>\n              </md-elevated-button>\n            `\n          )}\n        </div>`;\n      } else {\n        return nothing;\n      }\n    } else {\n      return nothing;\n    }\n  }\n\n  shortenText(text: string, maxLength: number) {\n    if (text.length > maxLength) {\n      return text.substr(0, maxLength) + '...';\n    } else {\n      return text;\n    }\n  }\n\n  capitalizeFirstLetter(text: string): string {\n    if (text.length === 0) return text;\n\n    return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();\n  }\n\n  stripDomainForFacIcon(url: string) {\n    let domain = url.split('/')[2];\n    console.error(`Domain is ${domain}`);\n    return domain;\n  }\n\n  renderChatGPT(): any {\n    return html`\n      <div class=\"layout vertical chatGPTDialogContainer\">\n        <div\n          class=\"chatGPTDialog layout vertical bot-message\"\n          ?error=\"${this.isError}\"\n        >\n          <div class=\"layout ${this.wide ? 'horizontal' : 'vertical'}\">\n            <div class=\"layout vertical chatImage\">${this.renderCGImage()}</div>\n            <div class=\"layout vertical chatText\">\n              ${resolveMarkdown(this.message, {\n                includeImages: true,\n                includeCodeBlockClassNames: true,\n                handleJsonBlocks: true,\n                targetElement: this,\n              })}\n              ${this.jsonLoading\n                ? html`<div class=\"layout horizontal center-center\">\n                    <md-circular-progress indeterminate></md-circular-progress>\n                  </div>`\n                : nothing}\n            </div>\n          </div>\n          ${this.renderJson()}\n        </div>\n        ${this.followUpQuestions && this.followUpQuestions.length > 0\n          ? html`\n              <div class=\"layout horizontal followup-question-container wrap\">\n                <md-icon class=\"followUpQuestionMark\">contact_support</md-icon\n                >${this.followUpQuestions.map(\n                  question => html`\n                    <md-outlined-button\n                      class=\"followup-question\"\n                      .label=\"${question}\"\n                      @click=\"${() => this.fire('followup-question', question)}\"\n                    ></md-outlined-button>\n                  `\n                )}\n              </div>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  parseFollowUpQuestions() {\n    this.followUpQuestionsRaw = this.followUpQuestionsRaw.replace(\n      /<<([^>>]+)>>/g,\n      (match, content) => {\n        this.followUpQuestions.push(content);\n        return '';\n      }\n    );\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has('followUpQuestionsRaw') &&\n      this.followUpQuestionsRaw\n    ) {\n      this.parseFollowUpQuestions();\n    }\n  }\n\n  renderUser(): any {\n    return html`\n      <div class=\"userChatDialog layout horizontal user-message\">\n        <div class=\"layout vertical chatImage\">${this.renderRoboImage()}</div>\n        <div class=\"layout vertical chatText chatTextUser\">\n          ${resolveMarkdown(this.message, {\n            includeImages: true,\n            includeCodeBlockClassNames: true,\n            handleJsonBlocks: true,\n            targetElement: this,\n          })}\n        </div>\n      </div>\n    `;\n  }\n\n  renderNoStreaming() {\n    return html`${this.spinnerActive\n        ? html`<svg class=\"progress-ring\" width=\"28\" height=\"28\">\n            <circle\n              class=\"progress-ring__circle\"\n              ?spinnerActive=\"${this.spinnerActive}\"\n              stroke=\"blue\"\n              stroke-width=\"2\"\n              fill=\"transparent\"\n              r=\"10\"\n              cx=\"12\"\n              cy=\"12\"\n            />\n          </svg>`\n        : html`<md-icon class=\"doneIcon\">done</md-icon>`}\n      <div class=\"thinkingText\" ?spinnerActive=\"${this.spinnerActive}\">\n        ${this.message}\n        ${this.updateMessage ? html`- ${this.updateMessage}` : nothing}\n      </div> `;\n  }\n\n  renderThinking() {\n    return html`${this.spinnerActive\n        ? html`<svg class=\"progress-ring\" width=\"28\" height=\"28\">\n            <circle\n              class=\"progress-ring__circle\"\n              ?spinnerActive=\"${this.spinnerActive}\"\n              stroke=\"blue\"\n              stroke-width=\"2\"\n              fill=\"transparent\"\n              r=\"10\"\n              cx=\"12\"\n              cy=\"12\"\n            />\n          </svg>`\n        : html`<md-icon class=\"doneIcon\">done</md-icon>`}\n      <div class=\"thinkingText\" ?spinnerActive=\"${this.spinnerActive}\">\n        ${this.getThinkingText()}\n      </div> `;\n  }\n\n  getThinkingText() {\n    //TODO: Fix this activate i18n\n    if (this.detectedLanguage == 'es') {\n      return 'MÃµeldes...';\n    } else if (this.detectedLanguage == 'is') {\n      return 'Hugsa...';\n    } else {\n      return 'Thinking...';\n    }\n  }\n\n  renderMessage() {\n    if (this.sender === 'you') {\n      return this.renderUser();\n    } else if (this.sender === 'bot' && this.type === 'thinking') {\n      return this.renderThinking();\n    } else if (this.sender === 'bot' && this.type === 'noStreaming') {\n      return this.renderNoStreaming();\n    } else if (this.sender === 'bot' && this.type === 'info') {\n      return this.renderInfo();\n    } else if (this.sender === 'bot') {\n      return this.renderChatGPT();\n    }\n  }\n\n  override render() {\n    return html` ${this.renderMessage()} `;\n  }\n}\n"]}